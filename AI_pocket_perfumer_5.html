<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>AI å£è¢‹èª¿é¦™å¸«ï½œStep Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --card: rgba(15, 23, 42, 0.9);
      --accent: #fb923c;
      --accent-soft: rgba(248, 171, 116, 0.18);
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.4);
      --pill-bg: rgba(15, 23, 42, 0.8);
      --shadow-soft: 0 24px 60px rgba(15, 23, 42, 0.9);
      --radius-xl: 26px;
      --radius-pill: 999px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Noto Sans TC", sans-serif;
      background: radial-gradient(circle at top, #111827 0, var(--bg) 55%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 24px;
    }

    .app {
      width: 100%;
      max-width: 1120px;
      margin: auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
    }

    .title-block h1 {
      margin: 0;
      font-size: 1.8rem;
      letter-spacing: 0.04em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-pill {
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      background: var(--accent-soft);
      color: var(--accent);
      font-size: 0.75rem;
      border: 1px solid rgba(249, 115, 22, 0.35);
    }

    .title-block p {
      margin: 6px 0 0;
      font-size: 0.86rem;
      color: var(--text-sub);
    }

    .badge {
      padding: 6px 12px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.76rem;
      color: var(--text-sub);
      display: flex;
      align-items: center;
      gap: 6px;
      backdrop-filter: blur(16px);
      background: rgba(15, 23, 42, 0.7);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 18px;
      transition: grid-template-columns 0.2s ease;
    }

    .layout.show-step2 {
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 1.05fr);
    }

    @media (max-width: 880px) {
      .layout,
      .layout.show-step2 {
        grid-template-columns: minmax(0, 1fr);
      }
      body { padding: 16px; }
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    .card {
      background: var(--card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 20px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(248, 171, 116, 0.28), transparent 60%),
                  radial-gradient(circle at bottom right, rgba(59, 130, 246, 0.18), transparent 60%);
      opacity: 0.55;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .card-inner { position: relative; z-index: 1; }

    .step-card.step2 { display: none; }
    .layout.show-step2 .step-card.step2 { display: block; }

    .section-title {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-sub);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title span.dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: linear-gradient(130deg, #f97316, #fb7185);
      box-shadow: 0 0 0 4px rgba(248, 171, 116, 0.15);
    }

    .field-group { margin-bottom: 16px; }

    .field-label {
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 6px;
    }

    .field-hint {
      font-size: 0.76rem;
      color: var(--text-sub);
      margin-bottom: 6px;
    }

    .radio-row,
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .radio-pill input { display: none; }

    .radio-pill label {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 12px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: var(--pill-bg);
      font-size: 0.8rem;
      color: var(--text-main);
      cursor: pointer;
      transition: all 0.18s ease;
      user-select: none;
      white-space: nowrap;
    }

    .radio-pill input:checked + label {
      border-color: var(--accent);
      color: #fed7aa;
      background: linear-gradient(135deg, rgba(248, 171, 116, 0.28), rgba(251, 113, 133, 0.18));
      box-shadow: 0 0 0 1px rgba(248, 171, 116, 0.2);
    }

    .pill {
      padding: 5px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 0.78rem;
      color: var(--text-sub);
      cursor: pointer;
      background: var(--pill-bg);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all 0.16s ease;
      user-select: none;
    }

    .pill.selected {
      border-color: var(--accent);
      color: #fed7aa;
      background: rgba(248, 171, 116, 0.2);
    }

    textarea {
      width: 100%;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.85);
      color: var(--text-main);
      padding: 8px 10px;
      font-size: 0.9rem;
      resize: vertical;
      min-height: 68px;
      outline: none;
      transition: border 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
    }

    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(248, 171, 116, 0.25);
      background: rgba(15, 23, 42, 0.96);
    }

    .slider-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
    }

    input[type="range"] {
      width: 100%;
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
    }
    input[type="range"]::-webkit-slider-runnable-track {
      height: 6px;
      background: linear-gradient(90deg, rgba(148, 163, 184, 0.3), rgba(248, 171, 116, 0.7));
      border-radius: 999px;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 999px;
      border: 2px solid #0b1120;
      background: radial-gradient(circle at 30% 30%, #fee2e2, #fb923c);
      margin-top: -5px;
      box-shadow: 0 0 0 4px rgba(248, 171, 116, 0.25);
    }

    .btn-primary {
      border: none;
      border-radius: var(--radius-pill);
      padding: 9px 18px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      color: #0b1120;
      background: linear-gradient(135deg, #fb923c, #fb7185);
      box-shadow: 0 14px 30px rgba(248, 171, 116, 0.45);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 40px rgba(248, 171, 116, 0.7);
      filter: brightness(1.03);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 10px 22px rgba(248, 171, 116, 0.4);
    }

    .btn-primary span.icon { font-size: 1.05rem; }

    .ghost-chip {
      font-size: 0.78rem;
      color: var(--text-sub);
      padding: 3px 8px;
      border-radius: var(--radius-pill);
      border: 1px dashed rgba(148, 163, 184, 0.5);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-top: 8px;
    }

    .result-block {
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 10px 12px;
      margin-bottom: 12px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.96));
      font-size: 0.86rem;
      white-space: pre-line;
    }

    .result-title {
      font-size: 0.8rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-sub);
      margin-bottom: 4px;
    }

    .memo-card {
      margin-top: 8px;
      border-radius: 20px;
      padding: 12px 14px;
      background: radial-gradient(circle at top, rgba(248, 171, 116, 0.2), rgba(15, 23, 42, 0.98));
      border: 1px solid rgba(248, 171, 116, 0.5);
      font-size: 0.9rem;
    }

    .memo-name {
      font-size: 1.05rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .memo-tagline {
      font-size: 0.82rem;
      color: #fed7aa;
      margin-bottom: 8px;
    }

    .memo-section-title {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-sub);
      margin: 8px 0 4px;
    }

    .note-badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 4px;
    }

    .note-badge {
      padding: 4px 9px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(30, 64, 175, 0.7);
      background: rgba(15, 23, 42, 0.8);
      font-size: 0.76rem;
      color: #e0f2fe;
    }

    .memo-body {
      font-size: 0.86rem;
      color: var(--text-main);
      line-height: 1.5;
      margin-top: 4px;
    }

    .subdued {
      color: var(--text-sub);
      font-size: 0.78rem;
      margin-top: 6px;
    }

    .mixing-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at center, rgba(15, 23, 42, 0.4), rgba(15, 23, 42, 0.96));
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .mixing-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .mixing-card {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 22px;
      padding: 16px 18px;
      border: 1px solid rgba(248, 171, 116, 0.4);
      box-shadow: 0 22px 60px rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      max-width: 260px;
      text-align: center;
    }

    .bottle {
      width: 52px;
      height: 72px;
      border-radius: 18px 18px 12px 12px;
      border: 1px solid rgba(248, 171, 116, 0.6);
      background: conic-gradient(from 200deg, rgba(248, 171, 116, 0.9), rgba(251, 113, 133, 0.6), rgba(56, 189, 248, 0.4), rgba(248, 171, 116, 0.9));
      position: relative;
      overflow: hidden;
      animation: float 2s ease-in-out infinite;
    }

    .bottle::before {
      content: "";
      position: absolute;
      inset: 18% 10% 8%;
      border-radius: 14px;
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.7), transparent 60%);
      opacity: 0.6;
    }

    .bottle-cap {
      width: 26px;
      height: 12px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: radial-gradient(circle at 30% 0%, #e5e7eb, #6b7280);
      margin-bottom: 6px;
    }

    .mixing-text { font-size: 0.92rem; }
    .mixing-sub { font-size: 0.78rem; color: var(--text-sub); }

    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-4px); }
      100% { transform: translateY(0px); }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="title-block">
        <h1>
          AI å£è¢‹èª¿é¦™å¸«
          <span class="title-pill">step demo</span>
        </h1>
        <p>é€éå¹¾å€‹å•é¡Œï¼Œå’Œä¸€é»é»é­”æ³•ï¼Œç‚ºä½ èª¿å‡ºä¸€ç“¶å±¬æ–¼è‡ªå·±çš„é¦™ã€‚</p>
      </div>
      <div class="badge">
        <span>ğŸ§ª</span> 114-1 æ™ºæ…§äººæ©Ÿäº’å‹• Â· æœŸæœ«å°ˆæ¡ˆä»‹é¢ Demo
      </div>
    </header>

    <main class="layout" id="layout">
      <!-- STEP 01ï¼šé€²å ´ -->
      <section class="card step-card step1">
        <div class="card-inner">
          <div class="section-title">
            <span class="dot"></span>
            STEP 01 Â· é€²å ´ & é–‹å•Ÿæƒ³åƒ
          </div>

          <div class="field-group">
            <div class="field-label">é€™ç“¶é¦™ï¼Œä½ æœ€æƒ³åœ¨ä»€éº¼æ™‚å€™ä½¿ç”¨ï¼Ÿ</div>
            <div class="field-hint">å…ˆå¹«å®ƒé¸ä¸€å€‹æœ€ç†æƒ³çš„å ´æ™¯ï¼Œåƒå¹«å®ƒå®‰æ’ä¸€å€‹ä¸»è¦èˆå°ã€‚</div>
            <div class="radio-row" id="occasion-group">
              <div class="radio-pill">
                <input type="radio" name="occasion" id="oc1" value="æ—¥å¸¸ä¸Šèª²/ä¸Šç­" checked />
                <label for="oc1">æ—¥å¸¸ä¸Šèª²/ä¸Šç­</label>
              </div>
              <div class="radio-pill">
                <input type="radio" name="occasion" id="oc2" value="èˆ‡å¦ä¸€åŠç´„æœƒ" />
                <label for="oc2">èˆ‡å¦ä¸€åŠç´„æœƒ</label>
              </div>
              <div class="radio-pill">
                <input type="radio" name="occasion" id="oc3" value="èˆ‡è¦ªå‹ç›¸èš" />
                <label for="oc3">èˆ‡è¦ªå‹ç›¸èš</label>
              </div>
              <div class="radio-pill">
                <input type="radio" name="occasion" id="oc4" value="å»ç†±é¬§å ´åˆç‹‚æ­¡" />
                <label for="oc4">å»ç†±é¬§å ´åˆç‹‚æ­¡</label>
              </div>
              <div class="radio-pill">
                <input type="radio" name="occasion" id="oc5" value="æ—…è¡Œçš„æ™‚å€™" />
                <label for="oc5">æ—…è¡Œçš„æ™‚å€™</label>
              </div>
              <div class="radio-pill">
                <input type="radio" name="occasion" id="oc6" value="ä¸€å€‹äººè‡ªåœ¨ç¨è™•" />
                <label for="oc6">ä¸€å€‹äººè‡ªåœ¨ç¨è™•</label>
              </div>
              <div class="radio-pill">
                <input type="radio" name="occasion" id="oc7" value="æœ‰é‡è¦ä»»å‹™çš„é‚£å¤©" />
                <label for="oc7">æœ‰é‡è¦ä»»å‹™çš„é‚£å¤©</label>
              </div>
            </div>
          </div>

          <div class="field-group">
            <div class="field-label">ç•¶åˆ¥äººé è¿‘èåˆ°æ™‚ï¼Œä½ å¸Œæœ›ä»–å€‘è¦ºå¾—ä½ æ˜¯ï¼Ÿ</div>
            <div class="field-hint">å¯ä»¥è¤‡é¸ï¼Œåƒæ˜¯å¹«è‡ªå·±é¸å¹¾å€‹æ­¤åˆ»æƒ³è¢«ç†è§£ã€è¢«çœ‹è¦‹çš„æ¨£å­ã€‚</div>
            <div class="pill-row" id="persona-group">
              <button class="pill" data-value="æº«æŸ”">æº«æŸ”</button>
              <button class="pill" data-value="åŒ…å®¹">åŒ…å®¹</button>
              <button class="pill" data-value="ä¿è½">ä¿è½</button>
              <button class="pill" data-value="æ²‰ç©©">æ²‰ç©©</button>
              <button class="pill" data-value="ç†æ€§">ç†æ€§</button>
              <button class="pill" data-value="ç¥ç§˜">ç¥ç§˜</button>
              <button class="pill" data-value="æµªæ¼«">æµªæ¼«</button>
              <button class="pill" data-value="ç”œç¾">ç”œç¾</button>
              <button class="pill" data-value="ä¿çš®">ä¿çš®</button>
              <button class="pill" data-value="å……æ»¿å…ƒæ°£">å……æ»¿å…ƒæ°£</button>
              <button class="pill" data-value="å¸¶æœ‰é‹’èŠ’">å¸¶æœ‰é‹’èŠ’</button>
            </div>
          </div>

          <div class="field-group">
            <div class="field-label">ä½ å°é¦™å‘³çš„åœ°é›·æ˜¯ä»€éº¼ï¼Ÿ</div>
            <div class="field-hint">æœ‰è¦ºå¾—ã€Œä¸€èåˆ°å°±ä¸è¡Œã€çš„å‘³é“å—ï¼Ÿé¸å‡ºä¾†ï¼Œè®“æˆ‘å€‘å¹«ä½ é¿é–‹ã€‚</div>
            <div class="pill-row" id="avoid-group">
              <button class="pill" data-value="å¤ªç”œè†©">å¤ªç”œè†©</button>
              <button class="pill" data-value="ç²‰æ„Ÿé‡">ç²‰æ„Ÿé‡</button>
              <button class="pill" data-value="å¤ªæœ¨è³ª">å¤ªæœ¨è³ª</button>
              <button class="pill" data-value="å¤ªæ¿ƒ">å¤ªæ¿ƒ</button>
              <button class="pill" data-value="é ­æšˆ">é ­æšˆ</button>
              <button class="pill" data-value="å¤ªä¾µç•¥">å¤ªä¾µç•¥</button>
            </div>
          </div>

          <div class="field-group">
            <div class="field-label">å°æ–¼æˆ‘å€‘ç¾åœ¨å…±å‰µçš„é€™ç“¶é¦™ï¼Œä½ é‚„æœ‰ä»€éº¼æƒ³åƒæˆ–æœŸå¾…å‘¢ï¼Ÿ</div>
            <div class="field-hint">å¯ä»¥æå¯«å¿ƒæƒ…ã€ç•«é¢ï¼Œæˆ–åªå±¬æ–¼ä½ çš„å…§å¿ƒå°åŠ‡å ´ã€‚</div>
            <textarea
              id="imagination"
              placeholder="ä¾‹å¦‚ï¼šå…¶å¯¦æˆ‘ä¸æƒ³è¦åˆ¥äººèåˆ°ï¼Œä½†è‡ªå·±å»å¯ä»¥è¢«é€™å€‹é¦™æ°£åŒ…åœã€æ²ˆæµ¸åœ¨è‡ªå·±çš„å°å°ä¸–ç•Œè£¡ã€‚"
            ></textarea>
          </div>

          <div class="field-group">
            <div class="field-label">æ•´é«”æ¿ƒåº¦</div>
            <div class="field-hint">å¦‚æœæ¯”è¼ƒæ•æ„Ÿå®¹æ˜“é ­æšˆï¼Œå¯ä»¥é¸æ·¡ä¸€é»ï¼›å¦‚æœæƒ³è¦å­˜åœ¨æ„Ÿæ˜é¡¯ä¸€äº›ï¼Œå¯ä»¥å¾€æ¿ƒä¸€é»ã€‚</div>
            <div class="slider-row">
              <input type="range" id="intensity" min="0" max="100" step="5" value="60" />
              <span id="intensity-value" style="font-size:0.78rem;color:var(--text-sub);width:40px;text-align:right;">60%</span>
            </div>
          </div>

          <button class="btn-primary" id="mix-btn">
            <span class="icon">âœ¨</span>
            é–‹å§‹èª¿é¦™
          </button>

          <div class="ghost-chip">
            ä¸‹ä¸€æ­¥é©Ÿå°‡æœƒç”Ÿæˆä½ çš„å°ˆå±¬é…æ–¹èˆ‡æ•…äº‹ã€‚
          </div>
        </div>
      </section>

      <!-- STEP 02ï¼šèª¿é… & ç”Ÿæˆ -->
      <section class="card step-card step2">
        <div class="card-inner">
          <div class="section-title">
            <span class="dot"></span>
            STEP 02 Â· èª¿é… ï¼† ç”Ÿæˆ
          </div>

          <div class="result-block" id="summary-block">
            <div class="result-title">USAGE SCENARIO Â· ä½¿ç”¨æƒ…å¢ƒ</div>
            <div id="summary-text">
              é€™è£¡æœƒæ•´ç†å‡ºä¸€æ®µé—œæ–¼ã€Œä½ å’Œé€™ç“¶é¦™ã€çš„å°å°æ‘˜è¦ï¼Œè®“ä½ ç¢ºèª AI æœ‰æ²’æœ‰çœŸçš„è½æ‡‚ä½ ã€‚
            </div>
          </div>

          <div class="result-block" id="explain-block">
            <div class="result-title">WHY THESE NOTES? Â· ç‚ºä»€éº¼æ˜¯é€™å€‹é…æ–¹ï¼Ÿ</div>
            <div id="explain-text">
              èª¿é¦™å¸«æœƒåœ¨é€™è£¡è·Ÿä½ èªªï¼šç‚ºä»€éº¼æœƒç”¨é€™äº›é¦™èª¿ä¾†æç¹ªä½ ï¼Œä»¥åŠå®ƒå€‘åˆ†åˆ¥ç…§é¡§çš„æ˜¯å“ªä¸€ç¨®æ—¥å¸¸ã€‚
            </div>
          </div>

          <div class="memo-card" id="memo-card">
            <div class="memo-name" id="memo-name">Your Pocket Scent</div>
            <div class="memo-tagline" id="memo-tagline">ä¸€ç“¶é‚„åœ¨ç­‰å¾…ä½ æŒ‰ä¸‹é–‹å§‹çš„é¦™ã€‚</div>

            <div class="memo-section-title">KEY NOTES</div>
            <div class="note-badge-row" id="memo-notes">
              <span class="note-badge">å‰èª¿ï¼šBergamot</span>
              <span class="note-badge">ä¸­èª¿ï¼šJasmine</span>
              <span class="note-badge">å¾Œèª¿ï¼šCedarwood</span>
            </div>

            <div class="memo-section-title">STORY</div>
            <div class="memo-body" id="memo-story">
              ç•¶ä½ å®Œæˆ Step 01 ä¸¦æŒ‰ä¸‹ã€Œé–‹å§‹èª¿é¦™ã€å¾Œï¼Œé€™è£¡æœƒå‡ºç¾ä¸€æ®µåªå±¬æ–¼ä½ çš„é¦™æ°´æ•…äº‹ã€‚
            </div>

            <div class="memo-section-title">HOW TO USE</div>
            <div class="subdued">
              å¯ä»¥å°‡é€™å¼µå¡æˆªåœ–æ”¶è—ï¼Œç•¶ä½œæœªä¾†å¯¦éš›èª¿é¦™æˆ–æŒ‘é¸é¦™æ°´æ™‚çš„åƒè€ƒï¼šå ´æ™¯ã€æ°£è³ªã€é¦™èª¿æ–¹å‘ï¼Œéƒ½æœƒåœ¨é€™è£¡è¢«å¥½å¥½è¨˜ä½ã€‚
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- èª¿é…ä¸­ overlay -->
  <div class="mixing-overlay" id="mixing-overlay">
    <div class="mixing-card">
      <div class="bottle-cap"></div>
      <div class="bottle"></div>
      <div class="mixing-text">æ­£åœ¨ç‚ºä½ èª¿é¦™ä¸­â€¦</div>
      <div class="mixing-sub">æŠŠå‰›å‰›èªªçš„æ¯ä¸€å€‹å°ç´°ç¯€ï¼Œéƒ½ä¸€æ»´ä¸€æ»´åŠ é€²ç“¶å­è£¡ã€‚</div>
    </div>
  </div>

  <script>
    // å¤šé¸ pill è¡Œç‚º
    function setupPillGroup(containerId) {
      const container = document.getElementById(containerId);
      const pills = Array.from(container.querySelectorAll(".pill"));
      pills.forEach(pill => {
        pill.addEventListener("click", () => {
          pill.classList.toggle("selected");
        });
      });
      return () => {
        return pills
          .filter(p => p.classList.contains("selected"))
          .map(p => p.getAttribute("data-value"));
      };
    }

    const getPersona = setupPillGroup("persona-group");
    const getAvoid = setupPillGroup("avoid-group");

    // æ¿ƒåº¦é¡¯ç¤º
    const intensityInput = document.getElementById("intensity");
    const intensityValue = document.getElementById("intensity-value");
    intensityInput.addEventListener("input", () => {
      intensityValue.textContent = intensityInput.value + "%";
    });

    const layout = document.getElementById("layout");
    const mixBtn = document.getElementById("mix-btn");
    const overlay = document.getElementById("mixing-overlay");

    mixBtn.addEventListener("click", () => {
      const occasion = document.querySelector("input[name='occasion']:checked").value;
      const persona = getPersona();
      const avoid = getAvoid();
      const imagination = document.getElementById("imagination").value.trim();
      const intensity = Number(intensityInput.value);

      overlay.classList.add("visible");

      setTimeout(() => {
        overlay.classList.remove("visible");
        runPerfumer(occasion, persona, avoid, imagination, intensity);

        layout.classList.add("show-step2");

        const step2 = document.querySelector(".step-card.step2");
        step2.scrollIntoView({ behavior: "smooth", block: "start" });
      }, 900);
    });

    function buildSummary(occasion, persona, avoid, imagination) {
      const parts = [];
      if (occasion) {
        parts.push(`ä½ æƒ³åœ¨ã€Œ${occasion}ã€çš„æ™‚å€™ï¼Œè®“é€™ç“¶é¦™é™ªåœ¨èº«é‚Šã€‚`);
      }
      if (persona.length) {
        parts.push(`ç•¶åˆ¥äººé è¿‘æ™‚ï¼Œä½ å¸Œæœ›ä»–å€‘èåˆ°çš„ï¼Œä¸åªæ˜¯å‘³é“ï¼Œè€Œæ˜¯ä¸€å€‹ã€Œ${persona.join("ã€")}ã€çš„ä½ ã€‚`);
      }
      if (avoid.length) {
        parts.push(`æœ‰å¹¾å€‹é¦™å‘³åœ°é›·æ˜¯ä½ ä¸å¤ªèƒ½æ¥å—çš„ï¼š${avoid.join("ã€")}ã€‚é€™äº›éƒ½æœƒè¢«æº«æŸ”åœ°é¿é–‹ã€‚`);
      }
      if (imagination) {
        parts.push(`åœ¨å¿ƒè£¡ï¼Œä½ å·²ç¶“æœ‰æŸå€‹ç•«é¢ï¼š${imagination}`);
      }
      if (!parts.length) {
        return "ä½ é‚„æ²’æœ‰èªªå¤ªå¤šæ²’é—œä¿‚ï¼Œæˆ‘æœƒå…ˆå¾ä¸€ç“¶æº«æŸ”ã€ä¸æ‰“æ“¾äººçš„æ—¥å¸¸é¦™é–‹å§‹èª¿èµ·ã€‚";
      }
      return parts.join("\n\n");
    }

    // ç°¡æ˜“é¦™èª¿è³‡æ–™åº«
    const notesDB = [
      { name: "Bergamot", family: "citrus", layer: "å‰èª¿" },
      { name: "Grapefruit", family: "citrus", layer: "å‰èª¿" },
      { name: "Jasmine", family: "floral", layer: "ä¸­èª¿" },
      { name: "Rose", family: "floral", layer: "ä¸­èª¿" },
      { name: "Cedarwood", family: "woody", layer: "å¾Œèª¿" },
      { name: "Sandalwood", family: "woody", layer: "å¾Œèª¿" },
      { name: "Musk", family: "musk", layer: "å¾Œèª¿" },
      { name: "Amber", family: "amber", layer: "å¾Œèª¿" }
    ];

    function pickNotes(persona, avoid) {
      const has = (word) => persona.some(p => p.includes(word));
      let candidates = [];

      if (has("æº«æŸ”") || has("åŒ…å®¹") || has("æµªæ¼«") || has("ç”œç¾")) {
        candidates.push("floral", "amber");
      }
      if (has("ä¿è½") || has("æ²‰ç©©") || has("ç†æ€§") || has("å¸¶æœ‰é‹’èŠ’")) {
        candidates.push("woody", "musk");
      }
      if (has("ä¿çš®") || has("å……æ»¿å…ƒæ°£")) {
        candidates.push("citrus", "floral");
      }
      if (has("ç¥ç§˜")) {
        candidates.push("musk", "amber", "woody");
      }

      if (!candidates.length) candidates = ["citrus", "floral", "woody"];

      const avoidFamily = [];
      if (avoid.includes("å¤ªæœ¨è³ª")) avoidFamily.push("woody");
      if (avoid.includes("å¤ªç”œè†©")) avoidFamily.push("amber", "floral");

      const filteredFamilies = [...new Set(candidates)].filter(f => !avoidFamily.includes(f));

      const top = notesDB.filter(n => n.layer === "å‰èª¿" && filteredFamilies.includes(n.family));
      const mid = notesDB.filter(n => n.layer === "ä¸­èª¿" && filteredFamilies.includes(n.family));
      const base = notesDB.filter(n => n.layer === "å¾Œèª¿" && filteredFamilies.includes(n.family));

      return {
        top: top.slice(0, 2),
        mid: mid.slice(0, 2),
        base: base.slice(0, 2)
      };
    }

    function namePerfume(occasion, persona) {
      if (occasion.includes("é‡è¦ä»»å‹™")) return "After Mission Glow";
      if (occasion.includes("èˆ‡å¦ä¸€åŠç´„æœƒ")) return "Hidden Heartbeat";
      if (occasion.includes("ç†±é¬§å ´åˆ") || occasion.includes("ç‹‚æ­¡")) return "Electric Orbit";
      if (occasion.includes("è‡ªåœ¨ç¨è™•") || occasion.includes("ç¨è™•")) return "Soft Solitude";
      if (occasion.includes("æ—…è¡Œ")) return "Pocket Horizon";
      if (occasion.includes("æ—¥å¸¸ä¸Šèª²") || occasion.includes("ä¸Šç­")) {
        if (persona.includes("ä¿è½") || persona.includes("ç†æ€§")) return "Clean Lines";
        if (persona.includes("æº«æŸ”") || persona.includes("åŒ…å®¹")) return "Quiet Dawn";
        return "Pocket Daylight";
      }
      return "Unnamed Pocket Scent";
    }

    function conceptLine(name, occasion) {
      if (name === "After Mission Glow") {
        return "çµ¦æ¯ä¸€æ¬¡æ’éä¾†ã€å®Œæˆä»»å‹™å¾Œï¼Œé‚„æƒ³æº«æŸ”æŠ±æŠ±è‡ªå·±çš„ä½ ã€‚";
      }
      if (name === "Hidden Heartbeat") {
        return "è®“é è¿‘çš„äººåªèåˆ°ä¸€é»é»æƒ…ç·’èµ·ä¼ï¼Œå°±åƒä½ è—åœ¨å¿ƒçª©è£¡çš„å°å°å¿ƒè·³ã€‚";
      }
      if (name === "Soft Solitude") {
        return "ç‚ºé‚£äº›é¸æ“‡å’Œè‡ªå·±å¾…åœ¨ä¸€èµ·çš„å¤œæ™šï¼ŒæŠŠå®‰éœè®Šæˆä¸€å€‹æœ‰é¦™æ°£çš„åœ°æ–¹ã€‚";
      }
      if (name === "Quiet Dawn") {
        return "åƒæ¸…æ™¨ç¬¬ä¸€å£ç©ºæ°£ï¼Œæé†’ä½ ï¼šå°±ç®—ä¸–ç•Œå¾ˆåµï¼Œä½ å¯ä»¥å¾ˆæº«æŸ”ã€‚";
      }
      if (name === "Pocket Horizon") {
        return "è®“æ¯ä¸€æ®µè·¯é€”éƒ½æœ‰ä¸€é»å›ºå®šçš„å‘³é“ï¼Œå¥½åƒèµ°åˆ°å“ªè£¡éƒ½å¸¶è‘—è‡ªå·±çš„æˆ¿é–“ã€‚";
      }
      if (name === "Electric Orbit") {
        return "åœ¨äººç¾¤èˆ‡éŸ³æ¨‚çš„è»Œé“è£¡ï¼Œç•™ä¸€åœˆåªå±¬æ–¼ä½ çš„äº®åº¦ã€‚";
      }
      return "ä¸€ç“¶å¯ä»¥è¢«å¸¶å»ä»»ä½•åœ°æ–¹çš„å°å°å®ˆè­·é¦™ã€‚";
    }

    // WHY THESE NOTES
    function buildExplanation(occasion, persona, imagination, notes, intensity) {
      const lines = [];

      // å ´æ™¯ç›¸é—œèªªæ˜
      if (occasion.includes("é‡è¦ä»»å‹™")) {
        lines.push("å› ç‚ºä½ é¸æ“‡äº†åœ¨ã€Œæœ‰é‡è¦ä»»å‹™çš„é‚£å¤©ã€ä½¿ç”¨ï¼Œæˆ‘è®“é¦™æ°£çš„å¾Œèª¿æ›´æ²ˆä¸€é»ï¼Œåƒå®Œæˆä¸€æ•´å¤©çš„æˆ°é¬¥å¾Œï¼Œæ…¢æ…¢é¬†é–‹è‚©è†€çš„é‚£å£æ°£ã€‚");
      } else if (occasion.includes("æ—¥å¸¸ä¸Šèª²") || occasion.includes("ä¸Šç­")) {
        lines.push("æ—¥å¸¸ä¸Šèª²/ä¸Šç­çš„é¦™æ°´æ›´éœ€è¦è€èä¸”ä¸æ‰“æ“¾ï¼Œæ‰€ä»¥å‰èª¿æœƒç•™å¾—æ¸…çˆ½ï¼Œåƒæ˜¯ä¹¾æ·¨çš„ç©ºæ°£å‰›å¥½åœåœ¨ä½ èº«é‚Šã€‚");
      } else if (occasion.includes("è‡ªåœ¨ç¨è™•") || occasion.includes("ç¨è™•")) {
        lines.push("åœ¨ä½ æƒ³ä¸€å€‹äººè‡ªåœ¨ç¨è™•çš„æ™‚å€™ï¼Œé¦™æ°£æœƒåƒä¸€æ¢å°æ¯¯å­ï¼Œæ…¢æ…¢æŠŠä½ åŒ…èµ·ä¾†ï¼Œæ‰€ä»¥ä¸­ã€å¾Œèª¿ä»¥æ¯”è¼ƒæŸ”å’Œçš„é¦™æç‚ºä¸»ã€‚");
      } else if (occasion.includes("æ—…è¡Œ")) {
        lines.push("æ—…è¡Œæ™‚çš„é¦™æ°£æœƒè·Ÿè‘—ä½ å‡ºç¾åœ¨å„ç¨®æˆ¿é–“å’Œè¡—é“ï¼Œå› æ­¤æˆ‘è®“é¦™èª¿çš„è®ŠåŒ–æ¯”è¼ƒæº«å’Œï¼Œä¸æœƒéæ–¼æ¶èµ°é¢¨æ™¯çš„æ³¨æ„åŠ›ã€‚");
      } else if (occasion.includes("èˆ‡è¦ªå‹ç›¸èš")) {
        lines.push("å’Œè¦ªå‹ç›¸èšçš„æ™‚å€™ï¼Œé¦™æ°£åªéœ€è¦åœ¨é å¾—æ¯”è¼ƒè¿‘çš„ç¬é–“å‡ºç¾ï¼Œæ‰€ä»¥æ•´é«”èª¿æ€§æœƒåæŸ”å’Œï¼Œä¸æœƒè“‹éæ“æŠ±èˆ‡å°è©±ã€‚");
      } else if (occasion.includes("èˆ‡å¦ä¸€åŠç´„æœƒ")) {
        lines.push("ç´„æœƒæ™‚çš„é¦™æ°£é‡é»ä¸æ˜¯ã€Œé é å°±èƒ½èåˆ°ã€ï¼Œè€Œæ˜¯åœ¨ä½ é è¿‘èªªè©±ã€ä¸€èµ·èµ°è·¯æ™‚ï¼Œæ‰æ…¢æ…¢æµ®å‡ºä¾†ï¼Œæ‰€ä»¥æˆ‘è®“å‰èª¿ç•™å¾—è¼•ç›ˆä¸€äº›ï¼Œä¸­å¾Œèª¿è²¼å¾—æ›´è¿‘ä¸€é»ã€‚");
      } else if (occasion.includes("ç†±é¬§å ´åˆ") || occasion.includes("ç‹‚æ­¡")) {
        lines.push("åœ¨ç†±é¬§å ´åˆè£¡ï¼Œé¦™æ°£æœƒè·Ÿè‘—ä½ çš„å‹•ä½œå’Œé«”æº«å‡ºç¾ï¼Œå› æ­¤æˆ‘è®“ä¸­å¾Œèª¿æœ‰ä¸€é»ç¯€å¥æ„Ÿï¼Œè®“ä½ åœ¨äººç¾¤ä¸­ä¿æœ‰è‡ªå·±çš„é »ç‡ã€‚");
      }

      // æ°£è³ªç¾¤çµ„ï¼šæŸ”è»Ÿç³» & ç·šæ¢ç³»
      const softMap = ["æº«æŸ”", "åŒ…å®¹", "æµªæ¼«", "ç”œç¾"];
      const lineMap = ["ä¿è½", "æ²‰ç©©", "ç†æ€§", "å¸¶æœ‰é‹’èŠ’"];

      const softSelected = persona.filter(p => softMap.includes(p));
      const lineSelected = persona.filter(p => lineMap.includes(p));

      if (softSelected.length) {
        lines.push(
          `å› ç‚ºä½ æåˆ°æƒ³è¢«æ„Ÿè¦ºæˆã€Œ${softSelected.join("ã€")}ã€é€™ä¸€é¡æ¯”è¼ƒæŸ”è»Ÿçš„æ°£è³ªï¼Œæˆ‘é¸äº†ä¸€äº›å¸¶èŠ±æ„Ÿã€ä½†ä¸éåˆ†ç”œçš„é¦™èª¿ï¼Œè®“æº«æŸ”åƒå…‰æšˆï¼Œè€Œä¸æ˜¯ä¸€è¨˜é‡éŒ˜ã€‚`
        );
      }

      if (lineSelected.length) {
        lines.push(
          `è€Œã€Œ${lineSelected.join("ã€")}ã€é€™ä¸€å´çš„ä½ ï¼Œéœ€è¦ä¸€é»ç·šæ¢æ„Ÿï¼Œæ‰€ä»¥æˆ‘åŠ å…¥æœ¨è³ªèˆ‡éºé¦™ï¼Œè®“å°¾éŸ»ä¿æŒæ¸…æ™°ï¼Œåƒä½ åšæ±ºå®šçš„æ¨£å­ã€‚`
        );
      }

      if (persona.includes("ç¥ç§˜")) {
        lines.push("ç‚ºäº†ä¿ç•™ä¸€é»è·é›¢æ„Ÿèˆ‡å¥½å¥‡å¿ƒï¼Œæˆ‘è®“éºé¦™èˆ‡ç¥ç€ç•™åœ¨å¾Œæ–¹ï¼Œåƒæ™šä¸€é»æ‰æœƒé¡¯å½¢çš„ç§˜å¯†ã€‚");
      }

      // æ¿ƒåº¦ç›¸é—œ
      if (intensity <= 30) {
        lines.push("æ•´é«”æ¿ƒåº¦åæ·¡ï¼Œé©åˆä½ ä¸æƒ³æˆç‚ºæˆ¿é–“è£¡æœ€æ˜é¡¯çš„äººï¼Œä½†åœ¨ä½é ­æ·±å‘¼å¸æ™‚ï¼Œé‚„æ˜¯èƒ½èè¦‹è‡ªå·±ã€‚");
      } else if (intensity >= 75) {
        lines.push("å› ç‚ºä½ é¡˜æ„è®“é¦™æ°´çš„å­˜åœ¨æ„Ÿæ˜é¡¯ä¸€é»ï¼Œæ‰€ä»¥é…æ–¹ç•™äº†è¼ƒé£½æ»¿çš„ä¸­å¾Œèª¿ï¼Œè®“é‡è¦æ™‚åˆ»æ›´æœ‰å„€å¼æ„Ÿã€‚");
      }

      // è‡ªå·±å¯«çš„ç•«é¢
      if (imagination) {
        lines.push("ä½ å¯«ä¸‹çš„é‚£å€‹ç•«é¢ï¼Œæˆ‘ä¹Ÿæœ‰æ”¾åœ¨å¿ƒè£¡ï¼Œå®ƒæœƒæˆç‚ºé€™ç“¶é¦™çœŸæ­£çš„æ ¸å¿ƒã€‚");
      }

      return lines.join("\n\n");
    }

    // STORYï¼šä¾æƒ…å¢ƒ + æ°£è³ª
    function buildStory(occasion, persona, imagination) {
      const personaLabel = persona.length
        ? `é‚£å€‹ã€Œ${persona.join("ã€")}ã€çš„ä½ `
        : "ä½ è‡ªå·±æƒ³æˆç‚ºçš„æ¨£å­";

      let base;

      if (occasion.includes("èˆ‡å¦ä¸€åŠç´„æœƒ")) {
        base =
          `é€™ç“¶é¦™ä¸»è¦æ˜¯ç‚ºäº†ä½ å€‘ä¹‹é–“é‚£ä¸€é»é»è·é›¢æº–å‚™çš„ï¼š` +
          `ä¸æ˜¯ä¸€é€²é–€å°±å…ˆåˆ°é”å°æ–¹ï¼Œè€Œæ˜¯åœ¨ä½ é è¿‘èªªè©±ã€ä¸€èµ·èµ°è·¯ã€è‚©è†€ç¢°åˆ°çš„æ™‚å€™ï¼Œæ‰æ…¢æ…¢è¢«èåˆ°ã€‚` +
          `å®ƒä¸æœƒæ¶éçœ¼ç¥å’Œå°è©±çš„ç„¦é»ï¼Œåªæ˜¯åœ¨å°æ–¹é å¾—å¾ˆè¿‘çš„æ™‚å€™ï¼ŒæŠŠ${personaLabel}æ‚„æ‚„æ”¶é€²å‘¼å¸è£¡ã€‚`;
      } else if (occasion.includes("èˆ‡è¦ªå‹ç›¸èš")) {
        base =
          `å’Œè¦ªå‹ç›¸èšæ™‚ï¼Œé€™ç“¶é¦™æœƒåƒä¸€å€‹å®‰éœå¾…åœ¨æ—é‚Šçš„æœ‹å‹ï¼Œ` +
          `åœ¨æ“æŠ±ã€æ‹ç…§ã€ç¢°æ¯çš„ç¬é–“æ‰è¢«æ³¨æ„åˆ°ã€‚å®ƒä¸æœƒè®“ä½ è®Šå¾—ç–é›¢ï¼Œåè€Œåªæ˜¯å¢åŠ ä¸€é»ã€Œæ¯æ¬¡è¦‹åˆ°ä½ éƒ½æœƒæƒ³åˆ°çš„å‘³é“ã€ï¼Œ` +
          `è®“${personaLabel}è¢«è¨˜ä½ã€‚`;
      } else if (occasion.includes("ç†±é¬§å ´åˆ") || occasion.includes("ç‹‚æ­¡")) {
        base =
          `åœ¨äººç¾¤å’ŒéŸ³æ¨‚åŒ…åœçš„åœ°æ–¹ï¼Œé€™ç“¶é¦™ä¸æœƒå’ŒéŸ³é‡æ¯”å¤§è²ï¼Œ` +
          `è€Œæ˜¯ç·Šç·Šè²¼åœ¨ä½ çš„é«”æº«æ—é‚Šã€‚ç•¶ä½ åœ¨ç‡ˆå…‰ä¸‹è·³èˆã€ç§»å‹•ã€æ®æ‰‹æ™‚ï¼Œé¦™æ°£æœƒéš¨è‘—ä½ çš„ç¯€å¥å¸¶å‡ºä¸€é»è»Œè·¡ï¼Œ` +
          `å¥½åƒåœ¨å®£å‘Šï¼šåœ¨é€™éº¼åµçš„åœ°æ–¹ï¼Œä½ ä¾ç„¶æœ‰è‡ªå·±çš„é »ç‡ã€‚`;
      } else if (occasion.includes("æ—¥å¸¸ä¸Šèª²") || occasion.includes("ä¸Šç­")) {
        base =
          `é€™ç“¶é¦™æœƒå¾…åœ¨ä½ çš„ç­†è¨˜æœ¬ã€è¢å¹•å…‰èˆ‡èª²æ¡Œä¹‹é–“ã€‚ç•¶ä½ è¢«è¡Œç¨‹æ“ åˆ°å–˜ä¸éæ°£ï¼Œåªè¦ä½é ­æ·±å‘¼å¸ä¸€æ¬¡ï¼Œ` +
          `é¦™æ°£å°±æœƒæé†’ä½ ï¼šé™¤äº†èº«ä»½å’Œè§’è‰²ä¹‹å¤–ï¼Œé‚„æœ‰${personaLabel}ï¼Œä¹Ÿéœ€è¦è¢«ç…§é¡§ã€‚`;
      } else if (occasion.includes("é‡è¦ä»»å‹™")) {
        base =
          `åœ¨ä½ èµ°å‡ºæœƒè­°å®¤ã€äº¤å®Œå ±å‘Šã€æˆ–æ‹¿åˆ°æˆç¸¾å–®çš„é‚£ä¸€åˆ»ï¼Œå¾ˆå¤šäººåªè¨˜å¾—çµæœï¼Œ` +
          `é€™ç“¶é¦™åªè² è²¬è¨˜å¾—ä½ çš„éç¨‹ï¼šåŠ ç­çš„å¤œã€å¯«åˆ°æ‰‹é…¸çš„å­—ï¼Œä»¥åŠé‚„æ˜¯æ²’æœ‰æ”¾æ£„çš„é‚£å€‹ç¬é–“ã€‚` +
          `æ¯æ¬¡èåˆ°ï¼Œå®ƒéƒ½åœ¨æé†’ä½ ï¼Œä½ ä¸æ˜¯åªå‰©ä¸‹ã€Œå®Œæˆä»»å‹™çš„äººã€ï¼Œä¹Ÿæ˜¯${personaLabel}ã€‚`;
      } else if (occasion.includes("è‡ªåœ¨ç¨è™•") || occasion.includes("ç¨è™•")) {
        base =
          `åœ¨æ‰€æœ‰äººéƒ½ä»¥ç‚ºä½ åªæ˜¯èººåœ¨åºŠä¸Šæ»‘æ‰‹æ©Ÿçš„æ™šä¸Šï¼Œåªæœ‰ä½ å’Œé€™ç“¶é¦™çŸ¥é“ï¼Œ` +
          `ä½ å…¶å¯¦åœ¨æ¢å¾©ä¸–ç•Œçœ‹ä¸è¦‹çš„é‚£ä¸€éƒ¨åˆ†ã€‚é¦™æ°£æœƒåƒä¸€æ¢å°æ¯¯å­ï¼Œæ…¢æ…¢æŠŠæ•£è½ä¸€åœ°çš„è‡ªå·±ï¼Œä¸€é¡†é¡†æ’¿å›ä¾†ï¼Œ` +
          `è®“${personaLabel}æœ‰åœ°æ–¹å¥½å¥½åä¸‹ä¾†ã€‚`;
      } else if (occasion.includes("æ—…è¡Œ")) {
        base =
          `å®ƒæœƒåœ¨ä¸åŒåŸå¸‚çš„æµ´å®¤ã€çª—é‚Šã€æ—…é¤¨æ¡Œä¸Šå‡ºç¾ï¼Œåƒæ˜¯ä¸€å€‹æ‚„æ‚„è·Ÿè‘—ä½ ç§»å‹•çš„åº§æ¨™ã€‚` +
          `ä¸ç®¡ä½ ä»Šå¤©èº«åœ¨é™Œç”Ÿçš„å··å­ã€è»Šç«™é‚„æ˜¯æ©Ÿå ´ï¼Œåªè¦èåˆ°é€™å€‹å‘³é“ï¼Œå°±åƒçŸ­æš«å›åˆ°è‡ªå·±çš„æˆ¿é–“ï¼Œ` +
          `è®“${personaLabel}æœ‰ä¸€å€‹ç†Ÿæ‚‰çš„ç©ºæ°£å¯ä»¥åœç•™ã€‚`;
      } else {
        base =
          `é€™ä¸æ˜¯ä¸€ç“¶è¦æ›¿ä½ æ‰®æ¼”åˆ¥äººçš„é¦™æ°´ï¼Œè€Œæ˜¯æ›¿ä½ è¨˜ä½ä¸€äº›ç´°ç¯€çš„å®¹å™¨ï¼šèµ°å»Šç›¡é ­çš„ç‡ˆã€çª—é‚Šçš„åº§ä½ã€` +
          `ä»¥åŠé‚£äº›åªæœ‰ä½ è‡ªå·±çŸ¥é“çš„å°å°ç¬é–“ã€‚æ¯æ¬¡å™´ä¸Šï¼Œå®ƒéƒ½åœ¨æé†’ä½ ï¼Œ${personaLabel}ä¹Ÿå€¼å¾—è¢«å¥½å¥½çœ‹è¦‹ã€‚`;
      }

      if (imagination) {
        return imagination + "\n\n" + base;
      }
      return base;
    }

    function runPerfumer(occasion, persona, avoid, imagination, intensity) {
      const summaryText = buildSummary(occasion, persona, avoid, imagination);
      document.getElementById("summary-text").innerHTML = summaryText.replace(/\n/g, "<br>");

      const notes = pickNotes(persona, avoid);
      const name = namePerfume(occasion, persona);
      const concept = conceptLine(name, occasion);
      const explanation = buildExplanation(occasion, persona, imagination, notes, intensity);
      const story = buildStory(occasion, persona, imagination);

      document.getElementById("explain-text").innerHTML = explanation.replace(/\n/g, "<br>");

      document.getElementById("memo-name").textContent = name;
      document.getElementById("memo-tagline").textContent = concept;

      const memoNotes = document.getElementById("memo-notes");
      memoNotes.innerHTML = "";
      const pushNoteBadge = (layerName, list) => {
        list.forEach(n => {
          const span = document.createElement("span");
          span.className = "note-badge";
          span.textContent = `${layerName}ï¼š${n.name}`;
          memoNotes.appendChild(span);
        });
      };
      pushNoteBadge("å‰èª¿", notes.top);
      pushNoteBadge("ä¸­èª¿", notes.mid);
      pushNoteBadge("å¾Œèª¿", notes.base);

      document.getElementById("memo-story").textContent = story;
    }
  </script>
</body>
</html>
